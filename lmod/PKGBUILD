# Maintainer: Kyle Ladd <laddkyle@msu.edu>

_author="Robert McLay"

pkgname=lmod
pkgver=5.1.5
pkgrel=1
pkgdesc="Evironmental Modules System"
arch=('x86_64')
license=('MIT')
conflicts=('lmod')
depends=('lua>=5.2.0' 'lua-posix' 'lua-filesystem')
install=$pkgname.install
provides=('lmod')
url="http://www.tacc.utexas.edu/tacc-projects/mclay/lmod"
source=(http://downloads.sourceforge.net/project/lmod/Lmod-$pkgver.tar.bz2)
md5sums=('a82a461befd78bfada8dbfade6709b4a')

build() {
    cd "$srcdir/Lmod-$pkgver"

    ./configure --prefix=/usr/local/opt \
                --with-spiderCacheDir=/usr/local/opt/lmod/lmod/cache
    make
}

package() {
    cd "$srcdir/Lmod-$pkgver"
    make DESTDIR="$pkgdir" install

    mkdir -p "$pkgdir/usr/local/etc/profile.d"
    opt_perms=$(stat -c %a /usr/local/opt)

    install -m$opt_perms "$pkgdir/usr/local/opt/lmod/lmod/init/bash" \
        "$pkgdir/usr/local/etc/profile.d/$pkgname.sh"
    install -m$opt_perms "$pkgdir/usr/local/opt/lmod/lmod/init/csh" \
        "$pkgdir/usr/local/etc/profile.d/$pkgname.csh"
}
